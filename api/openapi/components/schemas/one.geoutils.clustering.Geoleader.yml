allOf:
  - $ref: ./bigdata.relational.SingleTableOperation.yml
  - type: object
    description: >-
      Apply the leader cluster algorithm on a set of coordinates.


      The only input field required is the coordinates field on which the

      clustering should be applied.


      The output is the union of the outputs generated by the operation in \p
      forEachCluster parameter.


      The cluster order is preserved.
    required:
      - coordsInputFieldName
      - cfg
    properties:
      coordsInputFieldName:
        type: string
        description: |-
          Name of the fields containing the coordinates of the stop.

          Usually expected to take the value "coordinatesStart", which contains
          the coordinates of the stop in the struct \ref StopSegmentStep.
      cfg:
        description: Algorithm configuration.
        allOf:
          - $ref: ./one.geoutils.clustering.GeoleaderCfg.yml
      forEachCluster:
        description: |-
          Operation to apply on all STOPs associated to a given cluster.

          Input(0): input rows associated to the current cluster.
          Input(1): single-row input containing the current cluster information
                    (IOP struct \ref GeoleaderCluster).
        oneOf:
          - $ref: ./bigdata.aggr.Average.yml
          - $ref: ./bigdata.aggr.Count.yml
          - $ref: ./bigdata.aggr.CountRows.yml
          - $ref: ./bigdata.aggr.CountUnique.yml
          - $ref: ./bigdata.aggr.Empty.yml
          - $ref: ./bigdata.aggr.Max.yml
          - $ref: ./bigdata.aggr.Min.yml
          - $ref: ./bigdata.aggr.MultiAggregation.yml
          - $ref: ./bigdata.aggr.Quantiles.yml
          - $ref: ./bigdata.aggr.Sum.yml
          - $ref: ./bigdata.mde.AddFields.yml
          - $ref: ./bigdata.mde.Complete.yml
          - $ref: ./bigdata.mde.CsvData.yml
          - $ref: ./bigdata.mde.DefaultRows.yml
          - $ref: ./bigdata.mde.DefaultTable.yml
          - $ref: ./bigdata.mde.EquiJoin.yml
          - $ref: ./bigdata.mde.FlexibleUnion.yml
          - $ref: ./bigdata.mde.GenerateTicks.yml
          - $ref: ./bigdata.mde.Input.yml
          - $ref: ./bigdata.mde.Merge.yml
          - $ref: ./bigdata.mde.Mux.yml
          - $ref: ./bigdata.mde.Partial.yml
          - $ref: ./bigdata.mde.Product.yml
          - $ref: ./bigdata.mde.StaticData.yml
          - $ref: ./bigdata.mde.Trace.yml
          - $ref: ./bigdata.mde.Unique.yml
          - $ref: ./bigdata.mde.Void.yml
          - $ref: ./bigdata.relational.Clip.yml
          - $ref: ./bigdata.relational.EquiJoin.yml
          - $ref: ./bigdata.relational.ForEachRow.yml
          - $ref: ./bigdata.relational.Grouping.yml
          - $ref: ./bigdata.relational.MapReduce.yml
          - $ref: ./bigdata.relational.Mux.yml
          - $ref: ./bigdata.relational.OperationChain.yml
          - $ref: ./bigdata.relational.Projection.yml
          - $ref: ./bigdata.relational.Reduce.yml
          - $ref: ./bigdata.relational.Rename.yml
          - $ref: ./bigdata.relational.Selection.yml
          - $ref: ./bigdata.relational.Skip.yml
          - $ref: ./bigdata.relational.Sort.yml
          - $ref: ./bigdata.relational.Union.yml
          - $ref: ./bigdata.relational.WithNamedTables.yml
          - $ref: ./one.bte.BestTimeRangeOp.yml
          - $ref: ./one.geomarketing.CrmMapper.yml
          - $ref: ./one.geomarketing.CrmMultiMapper.yml
          - $ref: ./one.geomarketing.DimensionMapper.yml
          - $ref: ./one.geomarketing.RecurrenceFilter.yml
          - $ref: ./one.geomarketing.RelativeTimeMap.yml
          - $ref: ./one.geomarketing.StatRefinement.yml
          - $ref: ./one.geomarketing.TimeMap.yml
          - $ref: ./one.geomarketing.ZoneMap.yml
          - $ref: ./one.geoutils.CgiToCoords.yml
          - $ref: ./one.geoutils.CgiToCoordsSmoothed.yml
          - $ref: ./one.geoutils.EventFilter.yml
          - $ref: ./one.geoutils.EventFilterListRemovals.yml
          - $ref: ./one.geoutils.GridMap.yml
          - $ref: ./one.geoutils.MultiGridMap.yml
          - $ref: ./one.geoutils.clustering.Geoleader.yml
          - $ref: ./one.geoutils.mvp.MvpChanges.yml
          - $ref: ./one.geoutils.mvp.MvpChangesFromStops.yml
          - $ref: ./one.geoutils.stopsegment.MergeShortStops.yml
          - $ref: ./one.geoutils.stopsegment.StopSegmentLegacy.yml
          - $ref: ./one.timeutils.MergeStays.yml
          - $ref: ./one.timeutils.SplitTimeInterval.yml
          - $ref: ./one.timeutils.StopsToNights.yml
          - $ref: ./one.timeutils.TimeRangeOverlaps.yml
        discriminator:
          propertyName: _class
